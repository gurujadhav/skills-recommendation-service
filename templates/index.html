<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Talent Bridge</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      body {
        background: #f5f7fa;
        color: #333;
        line-height: 1.6;
      }
      header {
        background: #2c3e50;
        color: #fff;
        padding: 15px 20px;
      }
      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      nav h1 {
        font-size: 1.5rem;
      }
      nav ul {
        list-style: none;
        display: flex;
        gap: 20px;
      }
      nav a {
        color: #fff;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
      }
      nav a:hover {
        color: #f39c12;
      }
      main {
        text-align: center;
        padding: 40px 20px;
      }
      main h1 {
        font-size: 2rem;
        color: #2c3e50;
      }
      main p {
        margin-top: 10px;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
        color: #555;
      }
      section {
        background: #fff;
        margin: 30px auto;
        padding: 25px 30px;
        border-radius: 10px;
        max-width: 600px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      }
      section h2 {
        margin-bottom: 20px;
        font-size: 1.5rem;
        color: #34495e;
        text-align: center;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      label {
        font-weight: 600;
      }
      input {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        outline: none;
        transition: border 0.3s;
      }
      input:focus {
        border-color: #2980b9;
      }
      button {
        background: #2980b9;
        color: #fff;
        padding: 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s;
      }
      button:hover {
        background: #1f6391;
      }
      #addUserResult,
      #recommendResult,
      #userDetailsResult {
        margin-top: 15px;
        padding: 12px;
        border-radius: 6px;
        font-weight: 500;
      }
      #addUserResult {
        background: #eafaf1;
        color: #2d7a46;
      }
      #recommendResult {
        background: #fef9e7;
        color: #7d6608;
      }
      #userDetailsResult {
        background: #e8f0fe;
        color: #1a73e8;
      }
      .error {
        background: #fdecea;
        color: #a94442;
      }
    </style>
  </head>

  <body>
    <header>
      <nav>
        <h1>Talent Bridge</h1>
        <ul>
          <li><a href="#addUser">Add User</a></li>
          <li><a href="#recommendation">Recommendation</a></li>
          <li><a href="#userDetails">User Details</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <h1>Talent Bridge - A Skill Recommendation Service</h1>
      <p>
        Get personalized career growth recommendations powered by AI. Add your
        profile and discover the next skill you should learn.
      </p>
    </main>

    <!-- Add User Section -->
    <section class="add-user" id="addUser">
      <h2>Add User</h2>
      <form id="userForm">
        <label for="name">Name</label>
        <input type="text" id="name" placeholder="John Doe" required />

        <label for="skills">Skills</label>
        <input type="text" id="skills" placeholder="Python, Flask..." required />

        <label for="learning_path">Learning Path</label>
        <input type="text" id="learning_path" placeholder="Data Science" />

        <button type="submit">Add User</button>
      </form>
      <div id="addUserResult"></div>
    </section>

    <!-- Recommendation Section -->
    <section class="recommendation" id="recommendation">
      <h2>Get Recommendations</h2>
      <form id="recommendForm">
        <label for="recommendUserId">User ID</label>
        <input type="number" id="recommendUserId" required placeholder="1" />
        <button type="submit">Get Recommendations</button>
      </form>
      <div id="recommendResult"></div>
    </section>

    <!-- User Details Section -->
    <section class="user-details" id="userDetails">
      <h2>Get User Details</h2>
      <form id="userDetailsForm">
        <label for="detailsUserId">User ID</label>
        <input type="number" id="detailsUserId" required placeholder="1" />
        <button type="submit">Get Details</button>
      </form>
      <div id="userDetailsResult"></div>
    </section>

    <script>
      // Add User
      document.getElementById("userForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value;
        const skills = document.getElementById("skills").value.split(",");
        const learning_path = document.getElementById("learning_path").value;

        const response = await fetch("/user", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, skills, learning_path })
        });

        const data = await response.json();
        document.getElementById("addUserResult").innerHTML = `<p>User Added! ID: ${data.user_id}</p>`;
      });

      // Get Recommendations
      document.getElementById("recommendForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const userId = document.getElementById("recommendUserId").value;

        if (userId <= 0) {
          document.getElementById("recommendResult").innerHTML = `<p class="error">User ID should be greater than 0.</p>`;
          return;
        }

        const response = await fetch(`/recommend/${userId}`);
        const data = await response.json();

        if (data.learning_path === undefined) {
          document.getElementById("recommendResult").innerHTML = `<p class="error">User with ID ${userId} not found.</p>`;
        } else {
          document.getElementById("recommendResult").innerHTML = `
            <p><b>Learning Path:</b> ${data.learning_path}</p>
            <p><b>Next Skill:</b> ${data["next-skill"]} 
              <button onclick="addSkill(${userId}, ${data.learningPath}, '${data["next-skill"]}')">Add Skill</button>
            </p>
            <p><b>Current Skills:</b> ${data.skills.join(", ")}</p>
          `;
        }
      });

      // Add recommended skill to user
      async function addSkill(userId, learningPath, skill) {
        // const response = await fetch(`/skills/${userId}`);
        // const data = await response.json();
        // let currentSkills = data.skills;
        // currentSkills.push(skill);

        // const learningPath = data.learning_path[0] || "";
        // console.log(currentSkills)
        const update = await fetch(`/add_skills/${userId}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ skills: skill, learning_path: learningPath })
        });

        const updated = await update.json();
        alert("Skill added successfully!");
        // Optionally refresh recommendation section
        document.getElementById("recommendForm").dispatchEvent(new Event("submit"));
      }

      // Get User Details
      document.getElementById("userDetailsForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const userId = document.getElementById("detailsUserId").value;

        const response = await fetch(`/skills/${userId}`);
        const data = await response.json();

        if (data.skills === undefined) {
          document.getElementById("userDetailsResult").innerHTML = `<p class="error">User not found.</p>`;
        } else {
          document.getElementById("userDetailsResult").innerHTML = `
            <p><b>User ID:</b> ${userId}</p>
            <p><b>Name:</b> ${data.name[0]}</p>
            <p><b>Learning Path:</b> ${data.learning_path[0]}</p>
            <p><b>Skills:</b> ${data.skills.join(", ")}</p>
          `;
        }
      });
    </script>
  </body>
</html>
